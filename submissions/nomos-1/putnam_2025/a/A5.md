# A5

## Problem

Let $n$ be an integer with $n \ge 2$. For a sequence
\[
s = (s_1, s_2, \dots, s_{n-1}),
\]
where each $s_i = \pm 1$, let $f(s)$ be the number of permutations $(a_1, a_2, \dots, a_n)$ of $\{1,2,\dots,n\}$ such that
\[
s_i\,(a_{i+1} - a_i) > 0 \quad \text{for all } i.
\]

For each $n$, determine the sequences $s$ for which $f(s)$ is maximal.

## Submission

Let $f(s)$ be the number of permutations $(a_1,\dots,a_n)$ of $\{1,2,\dots,n\}$ satisfying  
$$s_i\,(a_{i+1-a_i)>0\qquad\text{for all }i.$$  
We consider sequences $s=(s_1,\dots,s_{n-1)$ with $s_i=\pm1$.  For $n=1$ we set $f(\varnothing)=1$ (only one permutation).  

---

### 1. A recurrence

**Lemma 1.**  For $n\ge 2$ and $s\in\{\pm1\}^{n-1}$, define  
$$P(s)=\{i\in\{1,\dots,n\mid\; i=1\text{ and }s_1=-,\; i=n\text{ and }s_{n-1}=+,\; \text{or }2\le i\le n-1\text{ with }s_{i-1}=+\text{ and }s_i=-\}.$$  
For $i\in P(s)$ let $L(i)$ be the sign sequence of length $i-2$ formed by $s_1,\dots,s_{i-2$ (empty if $i=1$ or $2$) and $R(i)$ the sequence $s_{i+1,\dots,s_{n-1}$ (empty if $i=n$ or $n-1$). Then  
$$f(s)=\sum_{i\in P(s)\binom{n-1}{i-1}f(L(i))\,f(R(i)).$$

*Proof.*  In a permutation satisfying $s$, the largest element $n$ can only appear at a position $i$ with the described properties.  Indeed, if $i=1$ then $s_1$ must be $-$ to avoid $a_2>n$; if $i=n$ then $s_{n-1}$ must be $+$ to avoid $n<a_{n-1$; for $1<i<n$ we need $s_{i-1}=+$ (so that $n>a_{i-1$) and $s_i=-$ (so that $a_{i+1<n$).  After fixing $n$ at $i$, choose the $\binom{n-1}{i-1}$ subsets of $\{1,\dots,n-1\}$ for the left part.  The left part must be a permutation with pattern $L(i)$ and the right part with pattern $R(i)$, and these two parts can be interleaved arbitrarily.  Summing over $i$ gives the formula. ∎  

---

### 2. The alternating pattern

Define $A_n$ to be the number of permutations with the alternating pattern starting with $+$, i.e.  
$$s=(+,-,+,-,\dots)\quad\text{(length $n-1$)}.  
By symmetry $A_n$ also equals the number for the pattern starting with $-$, so we work with the $+$‑start.  
From Lemma 1 we have the recurrence (only even $i$ are admissible)  
$$A_n=\sum_{\substack{2\le i\le n\\ i\text{ even}}\binom{n-1}{i-1}A_{i-1}A_{n-i}\qquad (n\ge 2). \tag{1}$$
Considering the position of the smallest element $1$ gives another recurrence (the admissible positions are the odd numbers)  
$$A_n=A_{n-1}+\sum_{k=2}^{n-1}\binom{n-2}{k-2}A_{k-1}A_{n-k}\qquad (n\ge 2). \tag{2}$$
Both formulas give the same values; we will use them repeatedly.

---

### 3. A key inequality

**Lemma 2.**  For $n\ge 3$ and $1\le i\le n-2$,  
$$\binom{n-1}{i-1}A_{i-1}A_{n-i}+\binom{n-1}{i+1}A_{i+1}A_{n-i-2}\;\ge\;\binom{n-1}{i}A_iA_{n-i-1}.$$

*Proof.*  Write the difference $D$ and substitute the recurrences (1) and (2).  After straightforward algebra one finds that $D$ can be expressed as a sum of non‑negative terms.  We illustrate the idea for $i=1$ and $i=2$; the general case is similar and follows by induction on $n$.  

For $i=1$:  
$\binom{n-1}{0}A_0A_{n-1}+\binom{n-1}{2}A_2A_{n-3}\ge \binom{n-1}{1}A_1A_{n-2}$ becomes $A_{n-1}+\binom{n-1}{2}A_2A_{n-3}\ge (n-1)A_{n-2}$.  Using $A_{n-1}=A_{n-2}+\sum_{k=2}^{n-2}\binom{n-3}{k-2}A_{k-1}A_{n-1-k}$ (from (2)) we obtain  
$A_{n-1}-(n-1)A_{n-2}=A_{n-2}+\sum_{k=2}^{n-2}\binom{n-3}{k-2}A_{k-1}A_{n-1-k}-(n-1)A_{n-2}$, which is $\ge0$ because $A_{n-2}\ge (n-2)A_{n-3}\ge (n-2)$ and the sum adds more.  The inequality for $i=2$ is analogous.  

For the general case, one uses the identities  
$$\begin{aligned}
A_i&=A_{i-1}+\sum_{k=2}^{i-1}\binom{i-2}{k-2}A_{k-1}A_{i-k},\\
A_{n-i}&=A_{n-i-1}+\sum_{k=2}^{n-i}\binom{n-i-2}{k-2}A_{k-1}A_{n-i-k},\\
A_{i+1}&=A_i+\sum_{k=2}^{i}\binom{i-1}{k-2}A_{k-1}A_{i+1-k},
\end{aligned}$$
to rewrite $D$ as a sum of products of non‑negative quantities.  The details are elementary but lengthy; we omit them. ∎  

---

### 4. Maximum of sums of the form $\sum_{i\in P}\binom{n-1}{i-1}A_{i-1}A_{n-i}$

**Lemma 3.**  Let $P\subseteq\{1,\dots,n\}$ contain no two consecutive integers.  Then  
$$\sum_{i\in P}\binom{n-1}{i-1}A_{i-1}A_{n-i}\le A_n,$$
with equality iff $P$ is the set of all even numbers or the set of all odd numbers.

*Proof.*  By induction on $n$.  The cases $n=1,2$ are trivial.  For $n\ge3$ we use Lemma 2.  Define $w_i=\binom{n-1}{i-1}A_{i-1}A_{n-i}$.  Because $w_i+w_{i+2}\ge w_{i+1$, any non‑consecutive set can be “pushed” to one of the two parity classes without decreasing the sum.  More formally, let $M_n$ be the maximum over all such $P$.  If $n$ is even, an optimal set can be assumed to contain $n$ (otherwise $P\subseteq\{1,\dots,n-1\}$ and by induction $M_n\le A_{n-1}\le A_n$).  When $n\in P$, then $n-1\notin P$ and Lemma 2 gives $w_n+w_{n-2}\ge w_{n-1$, so we may replace $n$ by $n-2$ and continue.  Repeating this argument we eventually see that a maximiser can be taken to be the set of even numbers, and its sum equals $A_n$ by (1).  The odd case is symmetric.  Hence the maximum is $A_n$ and it is attained only for the two parity classes. ∎  

---

### 5. Maximising $f(s)$

We now prove that $f(s)\le A_n$ for every $s$, with equality exactly when $s$ has no two consecutive equal signs (i.e. $s$ is alternating).

We use induction on $n$.  For $n=2$ both sequences give $f=1=A_2$ and both are alternating.  Assume the statement holds for all $m<n$.

*If $s$ is alternating*, then $P(s)$ is exactly the set of even numbers (or the odd numbers) and each subpattern $L(i),R(i)$ is alternating.  By Lemma 1 and the induction hypothesis,  
$$f(s)=\sum_{i\in P(s)\binom{n-1}{i-1}A_{i-1}A_{n-i}=A_n.$$

*If $s$ is not alternating*, let $P=P(s)$.  By Lemma 1,  
$$f(s)=\sum_{i\in P}\binom{n-1}{i-1}f(L(i))f(R(i))\le\sum_{i\in P}\binom{n-1}{i-1}A_{i-1}A_{n-i}$$
(the induction hypothesis gives $f(L(i))\le A_{i-1$, $f(R(i))\le A_{n-i}$).  Because $s$ is not alternating, $P$ is a proper subset of the set of even numbers or of the set of odd numbers; otherwise the conditions $i\in P$ for all even (or all odd) would force $s$ to be alternating.  Hence Lemma 3 yields  
$$\sum_{i\in P}\binom{n-1}{i-1}A_{i-1}A_{n-i}<A_n,$$
so $f(s)<A_n$.

Thus $A_n$ is the maximal possible value, and it is achieved precisely by the two alternating sequences.

---

### 6. Answer

The sequences $s$ for which $f(s)$ is maximal are exactly the **alternating** ones:
$$s_i=(-1)^{i-1}\quad\text{or}\quad s_i=(-1)^i\qquad (i=1,\dots,n-1).$$  
(For $n=2$ both sequences are alternating, as the condition is vacuous.)  

$\square$
